### This is an effort to utilise the free GPU provided by Baidu AI Studio.

This piece of bash code was written from scratch without any third-party repository, unlike the ipynb version of this workflow. (which is the proper way to do it)

This is an all-in-one piece of code, so it is critical to think about the timing control to make sure the latter steps should only be excuted if the previous ones has finished correctly.

Given the nature of this time-limited free compute power, it is difficult to analyse the result on the fly. It is therefore suggested, after the simulation was done, the results were downloaded 
and analysed by a local `yank` installation. Potential an extended simulation to continue this simulation on differernt platforms is also possible.

It is supposed to run `bash run.sh` command on AI Studio, after having uploaded the two input files (`ligand.mol2` and `starting_end.pdb`)

<img width="1353" alt="image" src="https://github.com/user-attachments/assets/44e85a9d-f16f-44c6-8b35-da5c26c06b03" />

`run.sh`: 

```
# The user is expected to upload two files before submitting this script to clould simulation
# 1) ligand.mol2
# 2) starting_end.pdb
# Both files could be generated by https://github.com/quantaosun/Dock-MD-FEP, with `labodock_binder` then `Ambertools` prepared protein and small molecules.
#!/bin/bash

# Debugging info
nvidia-smi

# Install conda
wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh -O Miniconda3-latest-Linux-x86_64.sh
bash ./Miniconda3-latest-Linux-x86_64.sh -b -p $HOME/miniconda3
export PATH="$HOME/miniconda3/bin:$PATH"

# Proper conda initialization
eval "$(conda shell.bash hook)"
conda init bash
source ~/.bashrc

# Create environment
conda env create -f environment.yml -n Dock-MD-FEP || exit 1
conda activate Dock-MD-FEP || { echo "Failed to activate environment"; exit 1; }

# Prepare input files
mkdir -p Dock-MD-FEP/input
cd Dock-MD-FEP/input || exit 1

# Verify input files exist
[ ! -f ../../ligand.mol2 ] && { echo "ligand.mol2 missing"; exit 1; }
[ ! -f ../../starting_end.pdb ] && { echo "starting_end.pdb missing"; exit 1; }

cp ../../ligand.mol2 ./ligand.tripos.mol2
cp ../../starting_end.pdb ./receptor.pdbfixer.pdb
cd ..

# Verify YAML file exists
[ ! -f ../implicit-1000_per_iteration_doubled_lambda.yaml ] && { echo "YAML config missing"; exit 1; }
cp ../implicit-1000_per_iteration_doubled_lambda.yaml .

# Install analysis packages BEFORE simulation
conda install -c conda-forge pyyaml=5.4 seaborn matplotlib-base jupyter_core -y

# Run simulation
yank script --yaml=implicit-1000_per_iteration_doubled_lambda.yaml || { echo "Simulation failed"; exit 1; }

# Package results
tar -cvf Dock-MD-FEP.tgz ABF-implicit-output
[ -d /root/paddlejob/workspace/output/ ] || mkdir -p /root/paddlejob/workspace/output/
mv Dock-MD-FEP.tgz /root/paddlejob/workspace/output/

# Analysis
cd ABF-implicit-output || exit 1
yank analyze --store=./experiments/

echo "Simulation completed successfully. Results available in output directory."
```
